(function(e){function t(t){for(var o,c,i=t[0],s=t[1],l=t[2],u=0,b=[];u<i.length;u++)c=i[u],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&b.push(r[c][0]),r[c]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);d&&d(t);while(b.length)b.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var s=n[i];0!==r[s]&&(o=!1)}o&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},r={app:0},a=[];function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=s;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"065a":function(e,t,n){},"4b24":function(e,t,n){"use strict";n("77d4")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),r={class:"setting"},a={class:"dialog-footer"},c=Object(o["createTextVNode"])("取 消"),i=Object(o["createTextVNode"])("保 存"),s={id:"top-bar"},l={class:"left-col logo"},d=Object(o["createVNode"])("div",{class:"logo-name"},"Little Things",-1),u={class:"btn-group"},b={class:"el-dropdown-link"},p=Object(o["createTextVNode"])("待办事项"),f=Object(o["createTextVNode"])("统计报告（todo）"),m={class:"right-col top-actions"},h={class:"notes-count"},g={class:"btn-group"},v={class:"el-dropdown-link"},O=Object(o["createTextVNode"])("按优先级排序"),j=Object(o["createTextVNode"])("按更新时间排序"),k=Object(o["createTextVNode"])("按创建时间排序");function y(e,t,n,y,w,x){var N=Object(o["resolveComponent"])("el-option"),V=Object(o["resolveComponent"])("el-select"),_=Object(o["resolveComponent"])("el-form-item"),D=Object(o["resolveComponent"])("el-form"),C=Object(o["resolveComponent"])("el-button"),S=Object(o["resolveComponent"])("el-dialog"),T=Object(o["resolveComponent"])("icon-refresh"),P=Object(o["resolveComponent"])("icon-application-menu"),L=Object(o["resolveComponent"])("el-dropdown-item"),R=Object(o["resolveComponent"])("el-dropdown-menu"),B=Object(o["resolveComponent"])("el-dropdown"),E=Object(o["resolveComponent"])("icon-view-grid-card"),I=Object(o["resolveComponent"])("icon-view-grid-list"),U=Object(o["resolveComponent"])("icon-sort-two"),A=Object(o["resolveDirective"])("loading");return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createBlock"])("div",{id:"little-things",class:e.viewType,"element-loading-text":"拼命加载中"},[Object(o["createVNode"])("div",r,[Object(o["createVNode"])(S,{title:"🍑设置",modelValue:e.dialogVisible,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.dialogVisible=t}),width:"30%","before-close":e.handleClose},{footer:Object(o["withCtx"])((function(){return[Object(o["createVNode"])("span",a,[Object(o["createVNode"])(C,{onClick:t[3]||(t[3]=function(t){return e.dialogVisible=!1})},{default:Object(o["withCtx"])((function(){return[c]})),_:1}),Object(o["createVNode"])(C,{type:"primary",onClick:t[4]||(t[4]=function(t){return e.dialogVisible=!1})},{default:Object(o["withCtx"])((function(){return[i]})),_:1})])]})),default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(D,{ref:"setting",model:e.setting,"label-width":"80px"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(_,{label:"自动刷新"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(V,{modelValue:e.setting.refreshAlways,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.setting.refreshAlways=t}),placeholder:"是否自动刷新"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(N,{label:"自动刷新",value:"yes"}),Object(o["createVNode"])(N,{label:"手动刷新",value:"no"})]})),_:1},8,["modelValue"])]})),_:1}),Object(o["createVNode"])(_,{label:"日期显示"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(V,{modelValue:e.setting.date,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.setting.date=t}),placeholder:"请选择是否显示日期"},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(N,{label:"显示日期",value:"showDate"}),Object(o["createVNode"])(N,{label:"移除日期",value:"removeDate"})]})),_:1},8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["modelValue","before-close"])]),Object(o["createVNode"])("div",s,[Object(o["createVNode"])("div",l,[d,Object(o["createVNode"])("div",u,[Object(o["createVNode"])(T,{theme:"outline",size:"18",class:"btn",title:"刷新",onClick:t[6]||(t[6]=function(t){return e.getData("reload")})}),Object(o["createVNode"])(B,{trigger:"click"},{dropdown:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(R,null,{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(L,{icon:"el-icon-tickets",onClick:t[7]||(t[7]=function(t){return e.changeViewType("list-view")})},{default:Object(o["withCtx"])((function(){return[p]})),_:1}),Object(o["createVNode"])(L,{icon:"el-icon-date",onClick:t[8]||(t[8]=function(t){return e.changeViewType("report")})},{default:Object(o["withCtx"])((function(){return[f]})),_:1})]})),_:1})]})),default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])("span",b,[Object(o["createVNode"])(P,{theme:"outline",size:"18",class:"btn",title:"视图切换"})])]})),_:1})])]),Object(o["createVNode"])("div",m,[Object(o["createVNode"])("div",h,Object(o["toDisplayString"])(e.pageName),1),Object(o["createVNode"])("div",g,[e.showCard?(Object(o["openBlock"])(),Object(o["createBlock"])(E,{key:0,theme:"outline",size:"18",class:"btn",onClick:t[9]||(t[9]=function(t){return e.switchToCard(!1)})})):(Object(o["openBlock"])(),Object(o["createBlock"])(I,{key:1,theme:"outline",size:"18",class:"btn",onClick:t[10]||(t[10]=function(t){return e.switchToCard(!0)})})),Object(o["createVNode"])(B,{trigger:"click"},{dropdown:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(R,null,{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(L,{icon:"el-icon-wind-power",onClick:t[11]||(t[11]=function(t){return e.changeOrderBy("priority")})},{default:Object(o["withCtx"])((function(){return[O]})),_:1}),Object(o["createVNode"])(L,{icon:"el-icon-date",onClick:t[12]||(t[12]=function(t){return e.changeOrderBy("updated_stamp")})},{default:Object(o["withCtx"])((function(){return[j]})),_:1}),Object(o["createVNode"])(L,{icon:"el-icon-date",onClick:t[13]||(t[13]=function(t){return e.changeOrderBy("created_stamp")})},{default:Object(o["withCtx"])((function(){return[k]})),_:1})]})),_:1})]})),default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])("span",v,[Object(o["createVNode"])(U,{theme:"outline",size:"18",class:"btn",title:"排序"})])]})),_:1})])])]),(Object(o["openBlock"])(),Object(o["createBlock"])(Object(o["resolveDynamicComponent"])(e.viewType),{compData:e.compData,id:"main-content",class:e.viewType+"-comp",counts:e.counts},null,8,["compData","class","counts"]))],2)),[[A,e.loading]])}var w=n("1da1"),x=(n("ac1f"),n("1276"),n("a15b"),n("159b"),n("5319"),n("841c"),n("96cf"),n("3fd4")),N=n("d4ec"),V=n("bee2"),_=n("262e"),D=n("2caf"),C=(n("caad"),n("4de4"),n("2532"),n("4dec")),S=n("53ca"),T=(n("fb6a"),new Date),P=T.getDay(),L=T.getDate(),R=T.getMonth(),B=T.getYear();B+=B<2e3?1900:0;var E={strToTimeStamp:function(e){var t=e.slice(0,4),n=e.slice(4,6),o=e.slice(6,8),r=e.slice(8,10),a=e.slice(10,12),c=e.slice(12,14),i=t+"-"+n+"-"+o+" "+r+":"+a+":"+c,s=new Date(i).getTime();return s},getNowDay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string";return"string"==e?this.formatDate(new Date):new Date},getTomorrowDay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=new Date(T.getFullYear(),R,L+1);return"string"==e?this.formatDate(t):t},getAfterTomorrowDay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=new Date(T.getFullYear(),R,L+2);return"string"==e?this.formatDate(t):t},getStartDayOfWeek:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=P||7,n=new Date(T.getFullYear(),R,L+1-t);return"string"==e?this.formatDate(n):n},getEndDayOfWeek:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=P||7,n=new Date(T.getFullYear(),R,L+7-t);return"string"==e?this.formatDate(n):n},getStartDayOfMonth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=new Date(B,R,1);return"string"==e?this.formatDate(t):t},getEndDayOfMonth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=new Date(B,R,this.getMonthDays());return"string"==e?this.formatDate(t):t},getMonthDays:function(){var e=new Date(B,R,1),t=new Date(B,R+1,1),n=(t-e)/864e5;return n},formatDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"!=Object(S["a"])(e)&&(e=new Date(1*e));var n,o=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),c=e.getHours(),i=e.getMinutes(),s=e.getSeconds(),l=("0"+r).slice(-2),d=("0"+a).slice(-2),u=("0"+c).slice(-2),b=("0"+i).slice(-2),p=("0"+s).slice(-2);switch(t){case 0:n=o+"-"+l+"-"+d;break;case 1:n=o+"-"+l+"-"+d+" "+u+":"+b+":"+p;break;case 2:n=o+"/"+l+"/"+d+" "+u+":"+b+":"+p;break;case 3:n=o+"/"+l+"/"+d;break;case 4:n=o<B?o+"年"+r+"月"+a+"日":r+"月"+a+"日";break;default:n=o+"年"+r+"月"+a+"日";break}return n}},I={DateUtil:E},U=function(e){Object(_["a"])(n,e);var t=Object(D["a"])(n);function n(){var e;return Object(N["a"])(this,n),e=t.call(this,"database"),e.version(1).stores({todos:"&block_id, raw_content, pure_content, box, folder, doc, type, created, created_stamp, updated, updated_stamp, todo, priority, todo_index, priority_index, due, due_stamp"}),e.todos=e.table("todos"),e.today=new Date((new Date).toLocaleDateString()).getTime(),e.tomorrow=I.DateUtil.getTomorrowDay("date").getTime(),e.afterTomorrow=I.DateUtil.getAfterTomorrowDay("date").getTime(),e.weekStart=I.DateUtil.getStartDayOfWeek("date").getTime(),e.weekEnd=I.DateUtil.getEndDayOfWeek("date").getTime(),e.monthStart=I.DateUtil.getStartDayOfMonth("date").getTime(),e.monthEnd=I.DateUtil.getEndDayOfMonth("date").getTime(),e}return Object(V["a"])(n,[{key:"getTodos",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t,n){var o,r,a,c,i,s,l,d,u,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=["inbox","doing","done","someday"],r=["P0","P1","P2","P3"],c=this.today,i=this.tomorrow,s=this.afterTomorrow,l=this.weekStart,d=this.weekEnd,u=this.monthStart,b=this.monthEnd,t=t||"all",n=n||"updated","custom"==n&&(n=o.includes(t)?"todo_index":r.includes(t)?"priority_index":"updated"),e.t0=t,e.next="done"===e.t0?15:"today"===e.t0?17:"tomorrow"===e.t0?19:"week"===e.t0?21:"month"===e.t0?23:25;break;case 15:return a=function(e){return"done"==e.todo},e.abrupt("break",27);case 17:return a=function(e){return e.due_stamp>=c&&e.due_stamp<i&&"done"!=e.todo},e.abrupt("break",27);case 19:return a=function(e){return e.due_stamp>=i&&e.due_stamp<s&&"done"!=e.todo},e.abrupt("break",27);case 21:return a=function(e){return e.due_stamp>=l&&e.due_stamp<d&&"done"!=e.todo},e.abrupt("break",27);case 23:return a=function(e){return e.due_stamp>=u&&e.due_stamp<b&&"done"!=e.todo},e.abrupt("break",27);case 25:return a=function(e){return"done"!=e.todo},e.abrupt("break",27);case 27:if(["inbox","doing","someday"].includes(t)&&(a=function(e){return e.todo==t}),["P0","P1","P2","P3"].includes(t)&&(a=function(e){return e.priority==t&&"done"!=e.todo}),"created"!=n&&"updated"!=n){e.next=35;break}return e.next=32,this.todos.orderBy(n).filter(a).reverse().toArray();case 32:return e.abrupt("return",e.sent);case 35:return e.next=37,this.todos.orderBy(n).filter(a).toArray();case 37:return e.abrupt("return",e.sent);case 38:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getCounts",value:function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t){var n,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!["inbox","doing","someday"].includes(t)){e.next=4;break}return e.next=3,this.todos.where({todo:t}).and((function(e){return"done"!=e.todo})).count();case 3:n=e.sent;case 4:if(!["P0","P1","P2","P3"].includes(t)){e.next=8;break}return e.next=7,this.todos.where({priority:t}).and((function(e){return"done"!=e.todo})).count();case 7:n=e.sent;case 8:if("done"!=t){e.next=12;break}return e.next=11,this.todos.where({todo:"done"}).count();case 11:n=e.sent;case 12:if("today"!=t){e.next=16;break}return e.next=15,this.todos.filter((function(e){return e.due_stamp>=o.today&&e.due_stamp<o.tomorrow&&"done"!=e.todo})).count();case 15:n=e.sent;case 16:if("tomorrow"!=t){e.next=20;break}return e.next=19,this.todos.filter((function(e){return e.due_stamp>=o.tomorrow&&e.due_stamp<o.afterTomorrow&&"done"!=e.todo})).count();case 19:n=e.sent;case 20:if("week"!=t){e.next=24;break}return e.next=23,this.todos.filter((function(e){return e.due_stamp>=o.weekStart&&e.due_stamp<o.weekEnd&&"done"!=e.todo})).count();case 23:n=e.sent;case 24:if("month"!=t){e.next=28;break}return e.next=27,this.todos.filter((function(e){return e.due_stamp>=o.monthStart&&e.due_stamp<o.monthEnd&&"done"!=e.todo})).count();case 27:n=e.sent;case 28:if("all"!=t){e.next=32;break}return e.next=31,this.todos.filter((function(e){return"done"!=e.todo})).count();case 31:n=e.sent;case 32:return e.abrupt("return",n);case 33:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setTodoStatus",value:function(e,t){return this.todos.update(e,{todo:t})}},{key:"addTodo",value:function(e){return this.todos.add(e)}},{key:"updateTodo",value:function(e,t){return this.todos.update(e,t)}},{key:"deleteTodo",value:function(e){return this.todos.delete(e)}},{key:"setTodoIndex",value:function(e,t){return this.todos.update(e,{todo_index:t||0})}},{key:"setPriorityIndex",value:function(e,t){return this.todos.update(e,{priority_index:t||0})}}]),n}(C["a"]),A=(n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("bc3a")),z=n.n(A),$=(n("466d"),n("99af"),{IS_TEST:!1,TEST_URL:"http://127.0.0.1:6806",PROD_URL:"http://127.0.0.1:6806",database:"mydb5.3",table_name:"todo"});function M(){var e=F(),t={system:$,user:e};return t}function F(){try{return JSON.parse(localStorage.getItem("config"))}catch(e){return console.log("%c解析用户配置文件出错：","color:red"),console.log(e),!1}}function W(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var r=n[o].split("=");if(r[0]==e)return r[1]}return!1}function Y(e){var t,n,o,r,a,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",i=M(),s=i.user,l={danger:[""],warning:[""],success:[""],primary:[""]};s=s||l;var d="background-color:",u=["P0","P1"].concat(s.danger),b=["P2","doing"].concat(s.warning),p=["P3","P4","P5","done"].concat(s.success),f=["inbox"].concat(s.primary);return"element"==c?(t="info",n="danger",o="warning",r="success",a="primary"):(t=d+"#666666;",n=d+"#f56c6c;",o=d+"#e6a23c;",r=d+"#67c23a;",a=d+"#409eff;"),u.includes(e)&&(t=n),b.includes(e)&&(t=o),p.includes(e)&&(t=r),f.includes(e)&&(t=a),t}function q(e){var t;return t=$.IS_TEST?$.TEST_URL:$.PROD_URL,new Promise((function(n,o){z.a.post(t+"/api/query/sql",{stmt:e}).then((function(e){200==e.status&&(0==e.data.code?n(e.data.data):((void 0)("服务端正常反应，出现其他错误"),o(e.data)))})).catch((function(e){o(e)}))}))}function G(e){var t;return t=$.IS_TEST?$.TEST_URL:$.PROD_URL,new Promise((function(n,o){z.a.post(t+"/api/attr/setBlockAttrs",e).then((function(t){t&&((void 0)("设置块属性："),(void 0)(e),n(!0))})).catch((function(e){o(e)}))}))}function J(){return X.apply(this,arguments)}function X(){return X=Object(w["a"])(regeneratorRuntime.mark((function e(){var t,n,o,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"/参考文档/",e.prev=1,n="select b.id ,b.type,b.content, b.box,b.path,b.created,b.updated, a.name as attr_name, a.value as attr_value from blocks as b left join attributes as a on b.id = a.block_id where b.type <> 'l' and ( a.name = 'custom-lz-todo' or a.name= 'custom-lz-priority' or a.name = 'custom-lz-todo-index' or a.name = 'custom-lz-priority-index' ) and b.path like '%"+t+"%' union select b.id ,b.type,b.content , b.box,b.path,b.created,b.updated, a.name as attr_name, a.value as attr_value from blocks as b left join attributes as a on b.id = a.block_id  where b.id in (select block_id from spans where (type = 'text' or type = 'tag') and (content like '%@20%' or content like '%@todo%') and path like '%"+t+"%')",e.next=5,q(n);case 5:if(o=e.sent,0==o.length){e.next=10;break}return e.abrupt("return",o);case 10:throw"远程数据请求结果为空";case 11:e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](1),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])}))),X.apply(this,arguments)}var H=Object(o["withScopeId"])("data-v-203f2812");Object(o["pushScopeId"])("data-v-203f2812");var K={class:"left-col"},Q={class:"todo-lists"},Z=Object(o["createVNode"])("div",{class:"list-name primary"},"全部事项",-1),ee={class:"list-number"},te={class:"list-group"},ne=Object(o["createVNode"])("div",{class:"list-head"},"待办",-1),oe=Object(o["createVNode"])("div",{class:"list-name normal"},"收集箱",-1),re={class:"list-number"},ae=Object(o["createVNode"])("div",{class:"list-name warning"},"进行中",-1),ce={class:"list-number"},ie=Object(o["createVNode"])("div",{class:"list-name primary"},"某天",-1),se={class:"list-number"},le=Object(o["createVNode"])("div",{class:"list-name success"},"已完成",-1),de={class:"list-number"},ue={class:"list-group"},be=Object(o["createVNode"])("div",{class:"list-head"},"日期",-1),pe=Object(o["createVNode"])("div",{class:"list-name danger"},"今天",-1),fe={class:"list-number"},me=Object(o["createVNode"])("div",{class:"list-name warning"},"明天",-1),he={class:"list-number"},ge=Object(o["createVNode"])("div",{class:"list-name success"},"本周",-1),ve={class:"list-number"},Oe=Object(o["createVNode"])("div",{class:"list-name primary"},"本月",-1),je={class:"list-number"},ke={class:"list-group"},ye=Object(o["createVNode"])("div",{class:"list-head"},"优先级",-1),we=Object(o["createVNode"])("div",{class:"list-name danger"},"P0",-1),xe={class:"list-number"},Ne=Object(o["createVNode"])("div",{class:"list-name danger"},"P1",-1),Ve={class:"list-number"},_e=Object(o["createVNode"])("div",{class:"list-name warning"},"P2",-1),De={class:"list-number"},Ce=Object(o["createVNode"])("div",{class:"list-name success"},"P3",-1),Se={class:"list-number"},Te={class:"right-col"},Pe={key:0},Le=Object(o["createVNode"])("span",{class:"el-checkbox__inner"},null,-1),Re=Object(o["createVNode"])("input",{class:"el-checkbox__original",type:"checkbox",value:"false"},null,-1),Be={style:{"flex-grow":"1"}},Ee={class:"note-content"},Ie={class:"note-attrs"},Ue={key:0},Ae={key:1,style:{height:"100%"}};Object(o["popScopeId"])();var ze=H((function(e,t,n,r,a,c){var i=Object(o["resolveComponent"])("draggable"),s=Object(o["resolveComponent"])("el-empty"),l=Object(o["resolveComponent"])("el-scrollbar");return Object(o["openBlock"])(),Object(o["createBlock"])("div",null,[Object(o["createVNode"])("div",K,[Object(o["createVNode"])("div",Q,[Object(o["createVNode"])("div",{class:["all-lists","all"==e.listName?"chosen":""],onClick:t[1]||(t[1]=function(t){return e.clickList("all","all")})},[Z,Object(o["createVNode"])("div",ee,Object(o["toDisplayString"])(e.counts.all?e.counts.all:0),1)],2),Object(o["createVNode"])("div",te,[ne,Object(o["createVNode"])("ul",null,[Object(o["createVNode"])("li",{onClick:t[2]||(t[2]=function(t){return e.clickList("todo","inbox")}),class:"inbox"==e.listName?"chosen":""},[oe,Object(o["createVNode"])("div",re,Object(o["toDisplayString"])(e.counts.inbox?e.counts.inbox:0),1)],2),Object(o["createVNode"])("li",{onClick:t[3]||(t[3]=function(t){return e.clickList("todo","doing")}),class:"doing"==e.listName?"chosen":""},[ae,Object(o["createVNode"])("div",ce,Object(o["toDisplayString"])(e.counts.doing?e.counts.doing:0),1)],2),Object(o["createVNode"])("li",{onClick:t[4]||(t[4]=function(t){return e.clickList("todo","someday")}),class:"someday"==e.listName?"chosen":""},[ie,Object(o["createVNode"])("div",se,Object(o["toDisplayString"])(e.counts.someday?e.counts.someday:0),1)],2),Object(o["createVNode"])("li",{onClick:t[5]||(t[5]=function(t){return e.clickList("todo","done")}),class:"done"==e.listName?"chosen":""},[le,Object(o["createVNode"])("div",de,Object(o["toDisplayString"])(e.counts.done?e.counts.done:0),1)],2)])]),Object(o["createVNode"])("div",ue,[be,Object(o["createVNode"])("ul",null,[Object(o["createVNode"])("li",{onClick:t[6]||(t[6]=function(t){return e.clickList("date","today")}),class:"today"==e.listName?"chosen":""},[pe,Object(o["createVNode"])("div",fe,Object(o["toDisplayString"])(e.counts.today?e.counts.today:0),1)],2),Object(o["createVNode"])("li",{onClick:t[7]||(t[7]=function(t){return e.clickList("date","tomorrow")}),class:"tomorrow"==e.listName?"chosen":""},[me,Object(o["createVNode"])("div",he,Object(o["toDisplayString"])(e.counts.tomorrow?e.counts.tomorrow:0),1)],2),Object(o["createVNode"])("li",{onClick:t[8]||(t[8]=function(t){return e.clickList("date","week")}),class:"week"==e.listName?"chosen":""},[ge,Object(o["createVNode"])("div",ve,Object(o["toDisplayString"])(e.counts.week?e.counts.week:0),1)],2),Object(o["createVNode"])("li",{onClick:t[9]||(t[9]=function(t){return e.clickList("date","month")}),class:"month"==e.listName?"chosen":""},[Oe,Object(o["createVNode"])("div",je,Object(o["toDisplayString"])(e.counts.month?e.counts.month:0),1)],2)])]),Object(o["createVNode"])("div",ke,[ye,Object(o["createVNode"])("ul",null,[Object(o["createVNode"])("li",{onClick:t[10]||(t[10]=function(t){return e.clickList("priority","P0")}),class:"P0"==e.listName?"chosen":""},[we,Object(o["createVNode"])("div",xe,Object(o["toDisplayString"])(e.counts.P0?e.counts.P0:0),1)],2),Object(o["createVNode"])("li",{onClick:t[11]||(t[11]=function(t){return e.clickList("priority","P1")}),class:"P1"==e.listName?"chosen":""},[Ne,Object(o["createVNode"])("div",Ve,Object(o["toDisplayString"])(e.counts.P1?e.counts.P1:0),1)],2),Object(o["createVNode"])("li",{onClick:t[12]||(t[12]=function(t){return e.clickList("priority","P2")}),class:"P2"==e.listName?"chosen":""},[_e,Object(o["createVNode"])("div",De,Object(o["toDisplayString"])(e.counts.P2?e.counts.P2:0),1)],2),Object(o["createVNode"])("li",{onClick:t[13]||(t[13]=function(t){return e.clickList("priority","P3")}),class:"P3"==e.listName?"chosen":""},[Ce,Object(o["createVNode"])("div",Se,Object(o["toDisplayString"])(e.counts.P3?e.counts.P3:0),1)],2)])])])]),Object(o["createVNode"])("div",Te,[Object(o["createVNode"])(l,{native:!1},{default:H((function(){return[0!=e.compData.length?(Object(o["openBlock"])(),Object(o["createBlock"])("div",Pe,[Object(o["createVNode"])(i,{class:["note-list",e.showCard],list:e.compData,disabled:!e.enableDrag,"item-key":"name",onStart:t[14]||(t[14]=function(t){return e.dragging=!0}),onEnd:t[15]||(t[15]=function(t){return e.dragging=!1})},{item:H((function(t){var n=t.element;return[Object(o["createVNode"])("div",{class:["list-item",e.getStyle("checked",n.todo)],id:"block-"+n.block_id,onContextmenu:function(t){return e.rightMenu(t,n.block_id)}},[Object(o["createVNode"])("div",{class:["checkbox",e.getStyle("priority",n.priority)],onClick:function(t){return e.setDone(n.block_id,n.todo)}},[Object(o["createVNode"])("span",{class:["el-checkbox__input",n.type]},[Le,Re],2)],10,["onClick"]),Object(o["createVNode"])("div",Be,[Object(o["createVNode"])("div",Ee,Object(o["toDisplayString"])(n.raw_content),1),Object(o["createVNode"])("div",Ie,[Object(o["createVNode"])("div",null,[Object(o["createVNode"])("span",{class:"doc",onClick:function(t){return e.openNote(n.block_id)}},"@"+Object(o["toDisplayString"])(n.doc),9,["onClick"]),n.due?(Object(o["openBlock"])(),Object(o["createBlock"])("span",Ue," @"+Object(o["toDisplayString"])(n.due),1)):Object(o["createCommentVNode"])("",!0)])])])],42,["id","onContextmenu"])]})),_:1},8,["class","list","disabled"])])):(Object(o["openBlock"])(),Object(o["createBlock"])("div",Ae,[Object(o["createVNode"])(s,{description:"暂无内容",style:{display:"flex","align-items":"center",height:"100%"}})]))]})),_:1})])])})),$e=(n("25f0"),n("b76a")),Me=n.n($e),Fe=Object(o["defineComponent"])({name:"ListView",display:"ListView",order:0,components:{draggable:Me.a},props:{compData:null,counts:null},computed:{showCard:function(){return this.$parent.showCard?"h-list":"v-list"},listName:function(){return this.$parent.listName},enableDrag:function(){return"custom"==this.$parent.order}},data:function(){return{dragging:!1,preTodoStatus:{}}},methods:{openNote:function(e){window.open("siyuan://notes/"+e,"_blank")},clickList:function(e,t){this.$parent.clickList(e,t)},setDone:function(e,t){var n=document.querySelector("#block-"+e);if(n.classList.contains("is-checked")){n.classList.remove("is-checked");var o=this.preTodoStatus[e]?this.preTodoStatus[e]:"inbox";this.$parent.setTodoStatus(e,o),delete this.preTodoStatus[e]}else this.preTodoStatus[e]=t,n.classList.add("is-checked"),this.$parent.setTodoStatus(e,"done")},updateStatus:function(e,t,n){var o={};o[t]=n,this.$parent.updateTodo(e,o),x["a"].success({message:"操作成功",type:"success"})},saveIndex:function(){for(var e=this.$parent.listGroup,t=this.compData,n=0;n<t.length;n++){var o=t[n]["block_id"],r=void 0,a=void 0;"todo"==e?(r={id:o,attrs:{"custom-lz-todo-index":n.toString()}},a={todo_index:n}):(r={id:o,attrs:{"custom-lz-priority-index":n.toString()}},a={priority_index:n}),G(r).then().catch((function(e){console.log(e)})),this.$parent.updateTodo(o,a)}},getStyle:function(e,t){return"priority"==e?Y(t):"checked"==e?"done"==t?"is-checked":"":void 0},rightMenu:function(e,t){var n=this;e.preventDefault(),this.$contextmenu({x:e.x,y:e.y,items:[{label:"待办状态",icon:"primary",children:[{label:"Inbox",icon:"normal",onClick:function(){n.updateStatus(t,"todo","inbox")}},{label:"Doing",icon:"warning",onClick:function(){n.updateStatus(t,"todo","doing")}},{label:"Done",icon:"success",onClick:function(){n.updateStatus(t,"todo","done")}},{label:"Someday",icon:"primary",onClick:function(){n.updateStatus(t,"todo","someday")}}]},{label:"优先级",icon:"primary",children:[{label:"P0",icon:"danger",onClick:function(){n.updateStatus(t,"priority","P0")}},{label:"P1",icon:"danger",onClick:function(){n.updateStatus(t,"priority","P1")}},{label:"P2",icon:"warning",onClick:function(){n.updateStatus(t,"priority","P2")}},{label:"P3",icon:"success",onClick:function(){n.updateStatus(t,"priority","P3")}}]}]});var o=document.querySelector(".mx-context-menu-host");o.addEventListener("click",(function(){var e=document.querySelector(".mx-context-menu-host");e&&e.remove()}))}},watch:{compData:{handler:function(){"custom"!=this.$parent.order||"todo"!=this.$parent.listGroup&&"priority"!=this.$parent.listGroup||this.saveIndex()},deep:!0}}});n("ddc5"),n("9386");Fe.render=ze,Fe.__scopeId="data-v-203f2812";var We=Fe,Ye=Object(o["createStaticVNode"])('<div class="left-col"><div class="todo-lists"><div class="all-lists"><div class="list-name primary">全部事项</div><div class="list-number">0</div></div><div class="list-group"><div class="list-head">待办</div><ul><li><div class="list-name normal">收集箱</div><div class="list-number">0</div></li><li><div class="list-name warning">进行中</div><div class="list-number">0</div></li><li><div class="list-name primary">某天</div><div class="list-number">0</div></li><li><div class="list-name success">已完成</div><div class="list-number">0</div></li></ul></div></div></div>',1),qe={class:"right-col"},Ge={class:"report-btn"},Je=Object(o["createVNode"])("div",{class:"report-content"}," 该模块待开发... ",-1);function Xe(e,t,n,r,a,c){var i=Object(o["resolveComponent"])("el-option"),s=Object(o["resolveComponent"])("el-select");return Object(o["openBlock"])(),Object(o["createBlock"])("div",null,[Ye,Object(o["createVNode"])("div",qe,[Object(o["createVNode"])("div",Ge,[Object(o["createVNode"])(s,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.value=t}),placeholder:"请选择",size:"small"},{default:Object(o["withCtx"])((function(){return[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.options,(function(e){return Object(o["openBlock"])(),Object(o["createBlock"])(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]),Je])])}var He=Object(o["defineComponent"])({data:function(){return{options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:""}}});n("d066a");He.render=Xe;var Ke=He,Qe=Object(o["defineComponent"])({name:"App",components:{ListView:We,Report:Ke},computed:{pageName:function(){return"list-view"==this.viewType?this.listName.toUpperCase()+": "+this.counts[this.listName]+" Notes":"report"==this.viewType?"报告":"Todo"}},data:function(){return{blockId:"",widgetSetting:{},compData:[],counts:{},loading:!1,viewType:"list-view",listName:"all",listGroup:"all",showCard:!1,dialogVisible:!1,where:"all",order:"updated",setting:{refreshAlways:"no",date:""}}},methods:{initWidget:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getWidgetSetting();case 2:return t.next=4,e.getData("reload");case 4:case"end":return t.stop()}}),t)})))()},getWidgetSetting:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){var n,o,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=W("blockid"),!n){t.next=5;break}e.blockId=n,t.next=7;break;case 5:throw x["a"].error("请在URL中配置块ID（blockid=XXX）"),"url 中未配置 blockid 信息";case 7:return o="SELECT b.id AS id, b.box AS box, b.type AS type, b.path AS path, a.name AS attrName, a.value AS attrValue FROM blocks AS b LEFT JOIN attributes AS a ON b.id = a.block_id WHERE b.id = '"+e.blockId+"'",t.next=10,q(o);case 10:if(r=t.sent,0!=r.length){t.next=13;break}throw"未查询到对应的块内容 BlockId:"+e.blockId;case 13:a=r[0].path.split("/"),a.pop(),a=a.join("/")+"/",e.widgetSetting.folderPath=a,console.log("获取用户之前保存的设置："),r.forEach((function(t){var n=t.attrName;"custom-lz-order-type"==n&&(e.widgetSetting.orderType=t.attrValue,console.log(" * ordertype："+e.orderType))}));case 19:case"end":return t.stop()}}),t)})))()},getData:function(){var e=arguments,t=this;return Object(w["a"])(regeneratorRuntime.mark((function n(){var o,r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:"no",t.loading=!0,r=t.widgetSetting.folderPath?t.widgetSetting.folderPath:"","reload"!=o){n.next=6;break}return n.next=6,t.getRemote(r);case 6:return n.next=8,t.db.getTodos(t.where,t.order);case 8:if(a=n.sent,t.compData=a,"reload"!=o){n.next=13;break}return n.next=13,t.getCounts();case 13:t.loading=!1;case 14:case"end":return n.stop()}}),n)})))()},getRemote:function(e){var t=this;return Object(w["a"])(regeneratorRuntime.mark((function n(){var o,r,a,c,i,s,l,d,u,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,J(e);case 2:if(o=n.sent,o){n.next=6;break}return x["a"].warning("未查询到待办事项"),n.abrupt("return",!1);case 6:t.db.todos.clear(),r=0;case 8:if(!(r<o.length)){n.next=28;break}return a=o[r],c=t.date.strToTimeStamp(a.created),i=t.date.strToTimeStamp(a.updated),s={block_id:a.id,box:a.box,folder:t.parseFolderName(a.path),doc:t.parseFileName(a.path).replace(".sy",""),type:a.type,created:t.date.formatDate(c),created_stamp:c,updated:t.date.formatDate(i),updated_stamp:i},l=/#?@([1-9]\d{3}-?(0[1-9]|1[0-2])-?(0[1-9]|[1-2][0-9]|3[0-1]))#?/,d=l.exec(a.content),s.raw_content=a.content,s.pure_content=a.content.replace(l,""),d&&(u=d[1],u=u.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3"),b=new Date(u).getTime(),s.due=u,s.due_stamp=b),"custom-lz-todo"==a.attr_name&&a.attr_value?s.todo=a.attr_value:s.todo="null","custom-lz-todo-index"==a.attr_name?s.todo_index=parseInt(a.attr_value):s.todo_index=999,"custom-lz-priority"==a.attr_name?s.priority=a.attr_value:s.priority="null","custom-lz-priority-index"==a.attr_name?s.priority_index=parseInt(a.attr_value):s.priority_index=999,-1!=a.content.search("@todo")&&"null"==s.todo&&(s.todo="inbox"),n.next=25,t.saveToLocal(s);case 25:r++,n.next=8;break;case 28:case"end":return n.stop()}}),n)})))()},getCounts:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){var n,o,r,a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n={},o=["all","inbox","doing","done","someday","today","tomorrow","week","month","P0","P1","P2","P3"],r=0;case 3:if(!(r<o.length)){t.next=12;break}return a=o[r],t.next=7,e.db.getCounts(a);case 7:c=t.sent,n[a]=c;case 9:r++,t.next=3;break;case 12:e.counts=n;case 13:case"end":return t.stop()}}),t)})))()},parseFolderName:function(e){var t=e.split("/"),n=t.length-2;return t[n]},parseFileName:function(e){var t=e.split("/"),n=t.length-1;return t[n]},saveToLocal:function(e){var t=this;return Object(w["a"])(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.db.todos.where({block_id:e.block_id}).toArray();case 2:if(o=n.sent,0!=o.length){n.next=8;break}return n.next=6,t.db.addTodo(e);case 6:n.next=16;break;case 8:return r=e.block_id,delete e.block_id,"null"==e.todo&&delete e.todo,999==e.todo_index&&delete e.todo_index,"null"==e.priority&&delete e.priority,999==e.priority_index&&delete e.priority_index,n.next=16,t.db.updateTodo(r,e);case 16:case"end":return n.stop()}}),n)})))()},changeViewType:function(e){this.viewType=e},clickList:function(e,t){this.listGroup=e,this.listName=t,this.where=t,this.order="updated",this.getData()},changeOrderBy:function(e){this.order=e,this.getData()},setTodoStatus:function(e,t){this.db.setTodoStatus(e,t);var n=e,o={id:n,attrs:{"custom-lz-todo":t}};G(o).then().catch((function(e){console.log(e)})),this.getCounts()},updateTodo:function(e,t){this.db.updateTodo(e,t),this.getCounts(),this.getData()},switchToCard:function(e){this.showCard=!!e},showSettingDialog:function(){this.dialogVisible=!0},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){console.log(t),e()})).catch((function(e){console.log(e)}))}},created:function(){this.db=new U,this.date=I.DateUtil},mounted:function(){this.initWidget(),this.db||Object(x["a"])("Widget Mounted..")}});n("4b24");Qe.render=y;var Ze=Qe,et=(n("7dd6"),n("3ef0")),tt=n.n(et),nt=function(e){e.use(x["b"],{locale:tt.a})},ot=n("ff9f"),rt=(n("793f"),n("5087"),n("fc61")),at=n.n(rt),ct=Object(o["createApp"])(Ze);ct.use(at.a),nt(ct),Object(ot["a"])(ct),ct.mount("#app")},"77d4":function(e,t,n){},"793e":function(e,t,n){},"7a3c":function(e,t,n){},9386:function(e,t,n){"use strict";n("7a3c")},d066a:function(e,t,n){"use strict";n("065a")},ddc5:function(e,t,n){"use strict";n("793e")}});